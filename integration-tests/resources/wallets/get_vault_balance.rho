new
  rl(`rho:registry:lookup`), ASIVaultCh,
  vaultCh, balanceCh,
  stdout(`rho:io:stdout`), log
in {

  rl!(`rho:rchain:asiVault`, *ASIVaultCh) |
  for (@(_, ASIVault) <- ASIVaultCh) {


    // REPLACE THE ASI ADDRESS HERE vvv
    match "%ASI_ADDR" {
      asiAddress => {

        log!(("Accessing vault at ASIAddress", asiAddress)) |

        // most ASIVault methods return an `Either[String, A] = (false, String) \/ (true, A)`
        @ASIVault!("findOrCreate", asiAddress, *vaultCh) |
        for (@(true, vault) <- vaultCh) {

          log!("Obtained vault, checking balance") |

          @vault!("balance", *balanceCh) |
          for (@balance <- balanceCh) {

            log!("%LOG_MARKER Vault %ASI_ADDR balance is ${balance}" %%{"balance":balance})
          }
        }
      }
    }

  } |

  contract log(@data) = {
    @"DEMO"!(data) | stdout!(data)
  }
}
